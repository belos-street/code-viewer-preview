var O=Object.defineProperty;var T=(n,e,t)=>e in n?O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var C=(n,e,t)=>T(n,typeof e!="symbol"?e+"":e,t);import{s as B,e as k,l as A,m as q,h as R,d as G,r as D,p as U,c as M,o as H,q as z,u as $,a as I,F as V,f as W,x as E,i as j,y as F}from"./index-6P_m874L.js";var N=(n=>(n.VSCode="vscode",n.Dracula="dracula",n.Eva="eva",n.Github="github",n.VSCodeDark="vscode-dark",n.DraculaDark="dracula-dark",n.EvaDark="eva-dark",n.GithubDark="github-dark",n))(N||{});function J(n){const{containerRef:e,itemHeight:t,items:s,buffer:d=10,onScroll:L,getItemHeight:w}=n,f=B(0),p=B(0),r=i=>w?w(i,t):t,S=(i,u)=>{const x=a(u),_=r(i);return{top:`${x}px`,height:`${_}px`,lineHeight:`${t}px`}},b=i=>({height:`${r(i)-t}px`}),o=k(()=>{let i=0;for(let u=0;u<s.length;u++)i+=r(s[u]);return i}),a=i=>{let u=0;for(let x=0;x<i;x++)u+=r(s[x]);return u},c=k(()=>{let i=0,u=s.length-1;for(;i<=u;){const x=Math.floor((i+u)/2);a(x)<f.value-d*t?i=x+1:u=x-1}return Math.max(0,Math.min(i-d,s.length-1))}),h=k(()=>{let i=c.value,u=0;for(;i<s.length&&u<p.value+d*2*t;)u+=r(s[i]),i++;return Math.min(i+d,s.length)}),m=k(()=>{const i=Math.max(0,c.value),u=Math.min(h.value,s.length);return s.slice(i,u)});let g=null;const P=()=>{e.value&&(g!==null&&cancelAnimationFrame(g),g=requestAnimationFrame(()=>{f.value=e.value.scrollTop,L&&L(f.value,m.value)}))};let l=null;const v=()=>{e.value&&(p.value=e.value.clientHeight)};return A(()=>{v(),e.value&&(e.value.addEventListener("scroll",P,{passive:!0}),l=new ResizeObserver(v),l.observe(e.value))}),q(()=>{e.value&&(e.value.removeEventListener("scroll",P),l&&(l.unobserve(e.value),l.disconnect()))}),{visibleLines:m,totalHeight:o,scrollTop:f,scrollToLine:i=>{if(!e.value)return;const u=Math.max(1,Math.min(i,s.length)),x=a(u-1);e.value.scrollTo({top:x,behavior:"smooth"})},getLinePosition:a,getLineStyle:S,getBoxStyle:b}}function K(n){const e={small:{height:18,fontSize:12},medium:{height:21,fontSize:14},large:{height:24,fontSize:16}},t=k(()=>e[n].height),s=k(()=>e[n].fontSize);return{lineHeight:t,lineFontSize:s}}function Q(n){return{all:n=n||new Map,on:function(e,t){var s=n.get(e);s?s.push(t):n.set(e,[t])},off:function(e,t){var s=n.get(e);s&&(t?s.splice(s.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var s=n.get(e);s&&s.slice().map(function(d){d(t)}),(s=n.get("*"))&&s.slice().map(function(d){d(e,t)})}}}class X{constructor(e){C(this,"plugins",new Map);C(this,"options");this.options=e}async registerPlugin(e){if(this.plugins.has(e.name)){console.warn(`Plugin "${e.name}" already exists. Skipping registration.`);return}this.plugins.set(e.name,e);const t={...this.options};try{await e.install(t),console.log(`Plugin "${e.name}" registered and installed.`)}catch(s){throw this.plugins.delete(e.name),s}}async uninstallPlugin(e){const t=this.plugins.get(e);if(!t){console.warn(`Plugin "${e}" does not exist. Skipping uninstallation.`);return}const s={...this.options};try{await t.uninstall(s),this.plugins.delete(e),console.log(`Plugin "${e}" uninstalled.`)}catch(d){throw console.error(`Error uninstalling plugin "${e}":`,d),d}}getPlugins(){return Array.from(this.plugins.values())}async destroy(){for(const e of this.getPlugins())await this.uninstallPlugin(e.name)}}function Y(n){const e=new Set,t=n.options.codeLines.value.reduce((o,a)=>({[a.id]:a.index,...o}),{}),s=n.getPlugins(),d=async()=>{await r()},L=async()=>{const o={};if(s.length===0)return o;for(const a of s){const c=await a.processedLines(n.options);w(o,c)}return o},w=(o,a)=>{for(const c in a){const h=a[c];o[c]?o[c].push(...h):o[c]=h}},f=o=>o.map((a,c)=>{const{startColumn:h,endColumn:m,style:g}=a,P=`${h}ch`,l=`${m-h}ch`;return R("span",{class:"column-highlight",key:`col-highlight-${c}`,style:{left:P,width:l,...g}})}),p=(o,a)=>{const c=[];let h={},m="",g=[];for(const l of a){const{container:v}=l;v==="view-line-content"&&(h={style:l.style}),v==="line-number"&&l.content&&c.push(R("span",{class:"line-number"},l.content)),v==="line-content"&&(l.content&&(m=l.content),l.columnHighlights&&l.columnHighlights.length>0&&(g=f(l.columnHighlights)))}const P=R("div",{class:"line-content"},[...g,...Array.isArray(m)?m:[m||o.content]]);c.push(P),o.vNode=R("div",{...h,class:"view-line-content"},c),e.add(o.id)},r=async()=>{const o=await L();for(const a of n.options.visibleLines.value){if(e.has(a.id))continue;const c=o[a.id];c&&p(a,c)}};return{destroyProcessedLines:()=>{e.clear()},updateProcessedLines:d,updateLinesMeta:o=>{const{codeLines:a}=n.options;for(const c of o){const{id:h,meta:m}=c,g=a.value[t[h]-1];g&&(g.meta={...m},e.delete(g.id))}d()}}}function Z(n,e){const{keyword:t,useRegex:s=!1,caseSensitive:d=!1,wholeWord:L=!1,maxResults:w}=e;if(!t.trim())return[];const f=[];let p;try{if(s){const r=d?"g":"gi";p=new RegExp(t,r)}else{let r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");L&&(r=`\\b${r}\\b`);const S=d?"g":"gi";p=new RegExp(r,S)}}catch(r){return console.error("Invalid search pattern:",r),[]}for(const r of n){const S=r.content,b=[];let o;for(;(o=p.exec(S))!==null;)b.push([o.index,o.index+o[0].length]),p.global||(p.lastIndex=o.index+o[0].length);if(b.length>0&&(f.push({line:r,matches:b}),w!==void 0&&f.length>=w))break}return f}function ee(n,e){let t=null;return function(...s){t!==null&&clearTimeout(t),t=setTimeout(()=>{n.apply(this,s),t=null},e)}}const te=["data-theme"],ne={class:"view-lines"},se=["data-line-id"],le=G({__name:"code-viewer",props:{code:{default:()=>[]},plugins:{default:()=>[]},size:{default:"medium"},language:{},theme:{default:N.VSCode}},setup(n,{expose:e}){const t=n,s=D(t.code.map((l,v)=>({...l,index:v+1,vNode:R("div",{class:"view-line-content"},[R("div",{class:"line-content"},l.content)])}))),{lineHeight:d,lineFontSize:L}=K(t.size),w=(l,v)=>{var i;const y=((i=l.meta)==null?void 0:i.boxHeightMultiplier)??0;return v*(1+y)},f=D(null),{visibleLines:p,totalHeight:r,scrollToLine:S,getLineStyle:b,getBoxStyle:o}=J({containerRef:f,itemHeight:d.value,items:s.value,onScroll:ee(()=>{h()},100),getItemHeight:w}),a=Q(),c=new X({codeLines:s,visibleLines:p,eventBus:a,language:t.language});t.plugins.map(async l=>await c.registerPlugin(l));const{updateProcessedLines:h,updateLinesMeta:m,destroyProcessedLines:g}=Y(c);return A(()=>{h()}),U(async()=>{await c.destroy(),g()}),e({scrollToLine:S,search:l=>Z(s.value,l),updateLinesMeta:m}),(l,v)=>(H(),M("div",{class:"code-viewer",style:z({fontSize:`${$(L)}px`}),"data-theme":l.theme},[I("div",{class:"code-viewer-content",ref_key:"codeViewerContentRef",ref:f},[I("div",{class:"view-scroll-placeholder",style:z({height:`${$(r)}px`})},null,4),I("div",ne,[(H(!0),M(V,null,W($(p),y=>{var i;return H(),M("div",{key:y.id,"data-line-id":y.id,class:"view-line",style:z($(b)(y,y.index-1))},[(H(),E(F(y.vNode))),(i=y.meta)!=null&&i.boxContent?(H(),M("div",{key:0,class:"line-box",style:z($(o)(y))},[(H(),E(F(y.meta.boxContent)))],4)):j("",!0)],12,se)}),128))])],512)],12,te))}});export{N as C,le as _};
